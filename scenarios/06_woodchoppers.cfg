#textdomain wesnoth-Dawn_of_Thunder

#define SPEARMAN_GUARD ID X Y
    [unit]
        type=Spearman
        id={ID}
        side=4
        x={X}
        y={Y}
    [/unit]
    [micro_ai]
        side=4
        ai_type=goto
        action=add
        [filter]
            id={ID}
        [/filter]
        [filter_location]
            [filter]
                id={ID}
            [/filter]
        [/filter_location]
    [/micro_ai]
#enddef

[scenario]
    id=06_woodchoppers
    next_scenario=07_deep_forest

    name= _ "Woodchoppers"
    map_data="{~add-ons/dawn_of_thunder/maps/06_woodchoppers.map}"
    {TURNS 32 26 20}
    victory_when_enemies_defeated=no

    {FIRST_WATCH}
    {SECOND_WATCH}
    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}

    {MOOD_HUSHED}

    [story]
        [part]
            story= _ "Our heroes continued their way in the direction of Wesmere in the following days. Autumn was slowly coming, and during their travel through Wesnoth's midlands, they saw many peasants harvesting their fields."
            background=story/fields.jpg
        [/part]
        [part]
            story= _ "They were always received as friends, which was surely because of the presence of a mage with them. Generally, the so-called <span font-style='italic'>Granary of Wesnoth</span>, as this region was called, didn't hold much danger for Fiannon and his companions, as it was well guarded by many garrisons."
            background=story/midlands-wesnoth.jpg
        [/part]
        [part]
            story= _ "Silam decided that it was safest to cross the Great River at Elensefar. This way, they would avoid passing through the impassable and untamed Gryphon Mountains."
            background=story/Elensefar.jpg
        [/part]
        [part]
            story= _ "A day's march away from Aldril, they decided to camp at the edge of the Grey Woods. It was a foggy day, one couldn't see far, and everyone was tired. They just hoped to find some acceptable beds and a good rest once they arrived in Aldril. Even though they had been walking for days without an enemy in sight, Silam set up some guards, as there were a lot of rumours in the air about the Grey Woods."
            background=story/map2.png
        [/part]
    [/story]
    {BIGMAP_WOODCHOPPERS}

    [side]
        side=1
        controller=human
        team_name=1
        user_team_name= _ "Aethen's representants"

        type=Elvish Thunderer
        id=Fiannon
        name= _ "Fiannon"
        profile=portraits/Fiannon.png
        canrecruit=yes
        unrenamable=yes

        recruit=""
        extra_recruit=Elvish Fighter,Elvish Archer,Elvish Shaman,Elvish Scout

        {GOLD 150 100 50}
        {INCOME 2 0 -2}
        {FLAG_VARIANT sylvan}
        fog=yes
    [/side]

    {STARTING_VILLAGES 1 {ON_DIFFICULTY 8 7 6}}

    [side]
        side=2
        controller=ai
        team_name=2
        user_team_name= _ "Fallen Faeries"
        no_leader=yes
        {GOLD 250 350 450}
        {INCOME 5 10 15}
        {FLAG_VARIANT undead}
        [ai]
            village_value=0
            [avoid]
                x,y=12,15
                radius=13
            [/avoid]
            aggression=1
        [/ai]
    [/side]
    [side]
        side=3
        controller=ai
        team_name=3
        user_team_name= _ "Bandits"

        no_leader=yes
#ifdef EASY
        recruit=Thug,Footpad,Rogue Mage
#endif

#ifdef NORMAL
        recruit=Thug,Footpad,Rogue Mage,Poacher
#endif

#ifdef HARD
        recruit=Thug,Footpad,Rogue Mage,Poacher,Thief
#endif
        [ai]
#ifdef EASY
            recruitment_pattern=fighter
#endif
#ifdef NORMAL
            recruitment_pattern=fighter,fighter,archer
#endif
#ifdef HARD
            recruitment_pattern=scout,fighter,archer,archer
#endif
            village_value=0
            [avoid]
                x,y=12,15
                radius=13
            [/avoid]
        [/ai]
        {GOLD 100 150 200}
        {INCOME 2 4 6}
        {FLAG_VARIANT6 ragged}

        [village]
            x=21
            y=27
        [/village]
        [village]
            x=26
            y=28
        [/village]
        [village]
            x=31
            y=27
        [/village]
        [village]
            x=36
            y=20
        [/village]
    [/side]
    [side]
        side=4
        controller=ai
        team_name=1
        user_team_name= _ "Garrison of Aldril"

        type=Lieutenant
        unrenamable=yes
        id=Raief
        name= _ "Raief"
        profile=portraits/Raief.png
        canrecruit=yes
        suppress_end_turn_confirmation=yes
        scroll_to_leader=no # in case their turns get too boring
        # Note that they can still perform combat, though, even if they can't move, but there's no need to scroll to the leader for that.
        # The game still ought to scroll to units for combat even if it skips the leader part...

        {GOLD 120 110 100}
        {INCOME 2 1 0}
        {FLAG_VARIANT loyalist}

        [village]
            x=10
            y=11
        [/village]
        [village]
            x=12
            y=11
        [/village]
        [village]
            x=11
            y=13
        [/village]
        [village]
            x=8
            y=12
        [/village]
        [village]
            x=6
            y=13
        [/village]
        [village]
            x=7
            y=15
        [/village]
        [village]
            x=8
            y=15
        [/village]
        [village]
            x=5
            y=15
        [/village]
        [village]
            x=4
            y=16
        [/village]
        [village]
            x=7
            y=17
        [/village]
        [village]
            x=9
            y=18
        [/village]
        [village]
            x=11
            y=19
        [/village]
        [village]
            x=13
            y=20
        [/village]
        [village]
            x=14
            y=18
        [/village]
        [village]
            x=15
            y=17
        [/village]
        [village]
            x=13
            y=16
        [/village]
        [village]
            x=17
            y=17
        [/village]
        [village]
            x=19
            y=16
        [/village]
        [village]
            x=18
            y=13
        [/village]
        [village]
            x=53
            y=25
        [/village]
    [/side]

    [event]
        name=prestart
        [time_area]
            x=5
            y=22
            radius=2

            {DUSK}
            {DAWN}
            {MORNING}
            {MORNING}
            {AFTERNOON}
            {AFTERNOON}
        [/time_area]
        [item]
            x=5
            y=22
            image=scenery/lighthouse.png
            halo=halo/lighthouse-aura.png
        [/item]
        [item]
            x=7
            y=15
            image=scenery/shop-sign.png~RC(magenta>purple)
        [/item]
        [item]
            x=4
            y=18
            image=scenery/transport-galleon-se.png~RC(magenta>purple)
        [/item]
        [item]
            x=7
            y=19
            image=scenery/galleon-se.png~RC(magenta>purple)
        [/item]
        [item]
            x=9
            y=20
            image=scenery/transport-galleon-se.png~RC(magenta>purple)
        [/item]
        [item]
            x=55
            y=21
            image=scenery/blood.png
            visible_in_fog=no
        [/item]
        {SPEARMAN_GUARD "guard1" 13 21}
        {SPEARMAN_GUARD "guard2" 16 19}
        {SPEARMAN_GUARD "guard3" 18 17}
        {SPEARMAN_GUARD "guard4" 20 16}
        {SPEARMAN_GUARD "guard5" 19 13}
        {SPEARMAN_GUARD "guard6" 16 11}
        {SPEARMAN_GUARD "guard7" 12 10}
        {SPEARMAN_GUARD "guard8" 10 10}
        {SPEARMAN_GUARD "guard9" 7 12}
        {SPEARMAN_GUARD "guard10" 4 13}
        {SPEARMAN_GUARD "guard11" 3 16}

        [micro_ai]
            side=4
            ai_type=goto
            action=add

            [filter]
                id=Raief
            [/filter]
            [filter_location]
                [filter]
                    id=Raief
                [/filter]
            [/filter_location]
        [/micro_ai]

        [recall]
            id=Alasar
            x=56
            y=34
        [/recall]
        [recall]
            id=Naia
            x=54
            y=35
        [/recall]
        [recall]
            id=Silam
            x=56
            y=35
        [/recall]
        [recall]
            id=Limwen
            x=57
            y=37
        [/recall]
        [recall]
            id=hunter1
            x=52
            y=34
        [/recall]
        [recall]
            id=hunter2
            x=54
            y=33
        [/recall]
        [recall]
            id=hunter3
            x=55
            y=39
        [/recall]
        [set_variable]
            name=duron_captured
            value=no
        [/set_variable]
        {BLACK_SCREEN}
        {LOCK_VIEW}
        {HIDE_UNIT}
    [/event]

    [event]
        name=start

        [delay]
            time=1000
        [/delay]

        [interim_text]
            #po: Trailing space is needed at the end to prevent the cutoff that
            #po: happens with italicized GUI2 text
            text= _ "<i>6. Woodchoppers </i>"
        [/interim_text]
        [clear_print]
        [/clear_print]
        {UNLOCK_VIEW}
        {RESET_SCREEN}
        {PLACE_IMAGE (scenery/anvil.png) 9 16}
        {PLACE_IMAGE (scenery/log.png) 52 23}
        {PLACE_IMAGE (scenery/log.png) 54 21}
        {PLACE_IMAGE (scenery/log.png) 58 22}
        {PLACE_IMAGE (scenery/log.png) 58 25}
        {PLACE_IMAGE (scenery/logs.png) 55 23}
        {PLACE_IMAGE (scenery/boat-se.png) 11 21}
        {PLACE_IMAGE (scenery/hay.png) 4 7}
        {PLACE_IMAGE (scenery/hay.png) 16 34}
        {PLACE_IMAGE (scenery/hay.png) 23 22}
        {PLACE_IMAGE (scenery/straw-bale.png) 15 35}
        {PLACE_IMAGE (scenery/straw.png) 15 34}
        {PLACE_IMAGE (scenery/straw-bale.png) 8 14}
        {PLACE_IMAGE (scenery/straw.png) 9 15}
        {PLACE_IMAGE (scenery/signpost.png) 48 33}
        {PLACE_IMAGE (scenery/cart-empty-se.png) 55 25}
        {PLACE_IMAGE (scenery/well.png) 18 14}
        {UNHIDE_UNIT}
        [redraw][/redraw]
        [delay]
            time=1
        [/delay]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=55,21
            side=1
        [/filter]
        [message]
            speaker=unit
            message=_ "Hey, guys, look! I found some drops of blood. Seems like there was a battle here!"
        [/message]
        [if]
            [have_unit]
                # wmllint: recognize woodchopper1
                # wmllint: recognize woodchopper2
                # wmllint: recognize woodchopper3
                # wmllint: recognize rider
                id=woodchopper1,woodchopper2,woodchopper3,rider
                x,y=55,21
            [/have_unit]
            [then]
                [message]
                    speaker=unit
                    # wmllint: local spelling Ronur
                    message=_ "Poor Ronur! I hope he's not dead yet!"
                [/message]
            [/then]
            [else]
                [message]
                    id=woodchopper1,woodchopper2,woodchopper3,rider
                    message=_ "Poor Ronur, I hope he's not dead yet!"
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=start
        [message]
            speaker=Silam
            message= _ "Hmmm, I have a really bad feeling about this. This forest seems far too silent to me."
        [/message]
        [message]
            speaker=Fiannon
            message= _ "Maybe we should place a few more guards out of precaution?"
        [/message]
        [delay]
            time=1000
        [/delay]
        [message]
            speaker=Naia
            message= _ "Did- Did you see that? There was something moving!"
        [/message]
        [message]
            speaker=Alasar
            # wmllint: local spelling Hrmpf
            message= _ "Hrmpf, whatever is lurking for us in this forest, it shall feel my blade."
        [/message]
        [delay]
            time=1000
        [/delay]
        [message]
            speaker=narrator
            message= _ "Suddenly you hear some distant voices."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            image="portraits/humans/ruffian.webp~BW(255)"
            #po: "guard" is short for "guard duty"; the ruffian is complaining about having to stand guard himself:
            message= _ "Oh man, this guard is sooo boring! There ain't even animals in this damn forest."
        [/message]
        [message]
            speaker=narrator
            image="portraits/fallen-faerie.png~RIGHT()~BW(255)"
            # wmllint: local spelling Heeeeyyy
            #po: Maeblie speaking (female), seductively:
            message= _ "Heeeeyyy, handsome young man! Don't you want to come here and have fun with us?"
        [/message]
        [message]
            speaker=narrator
            image="portraits/humans/ruffian.webp~BW(255)"
            #po: Ronur speaking (male):
            message= _ "Whoa, wait, where are you coming from? Did you just... out of the tree?"
        [/message]
        [message]
            speaker=narrator
            image="portraits/fallen-faerie.png~RIGHT()~BW(255)"
            #po: Maeblie speaking (female), still seductively:
            message= _ "Does it even matter? Wouldn't you rather come here and have fun with us?"
        [/message]
        [message]
            speaker=narrator
            image="portraits/humans/ruffian.webp~BW(255)"
            #po: Ronur speaking (male):
            message= _ "Wait... I shouldn't... meh, what's the worst that could possibly happen? What do you wanna do?"
        [/message]
        [message]
            speaker=narrator
            image="portraits/fallen-faerie.png~RIGHT()~BW(255)"
            #po: Maeblie speaking (female), still seductively:
            message= _ "Come here, and... I'll show you."
        [/message]
        [message]
            speaker=narrator
            image="portraits/humans/ruffian.webp~BW(255)"
            #po: Ronur speaking (male):
            message= _ "Of course."
        [/message]
        [message]
            speaker=narrator
            image="portraits/humans/ruffian.webp~BW(255)"
            #po: Ronur speaking (male); "like it rough" is a sexual reference:
            message= _ "Oh, wow, you sure like it rough. Hey, no! Halt, you're hurting me! Stop!"
        [/message]
        [message]
            speaker=narrator
            image="portraits/fallen-faerie.png~RIGHT()~BW(255)"
            #po: Maeblie speaking (female), revealing that this was what is sometimes known as a "Honey Trap":
            #po: https://tvtropes.org/pmwiki/pmwiki.php/Main/HoneyTrap
            message= _ "You're going to die, forest foe! Die! Die! Die!"
        [/message]
        [delay]
            time=500
        [/delay]
        [message]
            speaker=narrator
            image="portraits/humans/peasant.webp~BW(255)"
            #po: one of the other woodchoppers speaking (male):
            message= _ "What was that? Hey, Ronur is gone! Wait, is this blood?"
        [/message]
        [message]
            speaker=narrator
            image="portraits/humans/peasant.webp~BW(255)"
            # wmllint: local spelling HEEEELP
            #po: woodchopper speaking (male):
            message= _ "HEEEELP!!!"
        [/message]
        [message]
            speaker=narrator
            image="portraits/fallen-faerie.png~RIGHT()~BW(255)"
            #po: Maeblie speaking (female):
            message= _ "You are all gonna die!"
        [/message]
        [message]
            speaker=narrator
            image="portraits/humans/peasant.webp~BW(255)"
            # wmllint: local spelling Rhearent
            #po: woodchopper speaking (male):
            message= _ "Rhearent, call for help! Take the old donkey from the cart and make haste!"
        [/message]
        [message]
            speaker=narrator
            image="portraits/squire.png~BW(255)"
            #po: Rhearent speaking (male):
            message= _ "Sure, sir! Hold out, I'll be back soon!"
        [/message]
        [move_unit_fake]
            type=Squire
            side=4
            x=54,54,53,53,48,46
            y=25,26,27,31,33,32
        [/move_unit_fake]
        [unit]
            id=rider
            type=Squire
            name=_"Rhearent"
            random_traits=no
            side=4
            x=46
            y=32
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
            {IS_HERO}
        [/unit]
        [message]
            speaker=rider
            message= _ "Wait, what?"
        [/message]
        [move_unit]
            id=rider
            to_x=47,47,48,50,50,51
            to_y=33,34,34,35,36,37
        [/move_unit]
        [message]
            speaker=rider
            #po: Rhearent speaks with a bit of an accent, and often uses "ya" for "you":
            message= _ "Sorry, lads... (<i>gasp</i>) Didn't see ya... (<i>gasp</i>) ya know... (<i>gasp</i>) Adrenaline... (<i>gasp</i>)"
        [/message]
        [message]
            speaker=Naia
            message= _ "Calm down, Boy. Tell us, what's happening there in this forest?"
        [/message]
        [message]
            speaker=rider
            message= _ "We're tree fellers from Aldril, and our camp is attacked by dark beings. I was sent to search for help. Thankfully I found ya. Would have taken too much time to ride to Aldril."
        [/message]
        [message]
            speaker=rider
            message= _ "Please help my comrades!"
        [/message]
        [message]
            speaker=Fiannon
            message= _ "Of course. Just tell me, what attacked you?"
        [/message]
        [message]
            speaker=rider
            #po: "nae" = "not":
            message= _ "I don't know, I did nae see very much. Kinda looked like beautiful women."
        [/message]
        [message]
            speaker=Silam
            message= _ "Hmmm, beautiful women? That's strange, but I might have an idea who we might be facing. Anyway Rider, you may go now. We'll take care of your comrades."
        [/message]
        [message]
            speaker=rider
            message= _ "Hmmmm, yeah that's the problem. I don't know where to go. May I fight alongside you?"
        [/message]
        [message]
            speaker=Fiannon
            message= _ "Don't you want to ride to Aldril to tell your Lord?"
        [/message]
        [message]
            speaker=rider
            message= _ "I've heard that bandits have been sighted plundering random farms. So I'd prefer not to go alone."
        [/message]
        [message]
            speaker=Naia
            message= _ "Don't worry, you may rest with us."
        [/message]
        [message]
            speaker=rider
            message= _ "Thank ya my lady. Very kind of you."
        [/message]

        [modify_unit]
            [filter]
                id=rider
            [/filter]
            side=1
        [/modify_unit]

        [message]
            speaker=Alasar
            message= _ "Time for battle again!"
        [/message]
        [message]
            speaker=Limwen
            message= _ "Just don't hurt yourselves. Remember that I can heal you if you're wounded."
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Save the woodchoppers"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Fiannon"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Naia"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Silam"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                x,y=55,24
                radius=7
            [/filter_location]
        [/filter]

        {NAMED_NOTRAIT_UNIT 2 (Fallen Faerie) 56 19 (Maeblie) (_"Maeblie") } {SLOWED_IF_EASY}
        {GENERIC_UNIT 2 (Fallen Sprite) 48 22} {SLOWED_IF_EASY}
        {GENERIC_UNIT 2 (Fallen Sprite) 56 27} {SLOWED_IF_EASY}
        [unit]
            type=Woodsman
            id=woodchopper1
            side=1
            x=53
            y=25
            [modifications]
                {TRAIT_LOYAL}
#ifdef EASY
                {TRAIT_DEXTROUS}
                {TRAIT_RESILIENT}
#endif
            [/modifications]
            {IS_HERO}
        [/unit]
        [unit]
            type=Peasant
            id=woodchopper2
            side=1
            x=54
            y=23
            [modifications]
                {TRAIT_LOYAL}
#ifdef EASY
                {TRAIT_RESILIENT}
                {TRAIT_HEALTHY}
#endif
            [/modifications]
            {IS_HERO}
        [/unit]
        [unit]
            type=Ruffian
            id=woodchopper3
            side=1
            x=56
            y=24
            [modifications]
                {TRAIT_LOYAL}
#ifdef EASY
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
#endif
            [/modifications]
            {IS_HERO}
        [/unit]

        {CLEAR_FOG 1 55 24 7}

        [message]
            speaker=woodchopper2
            message= _ "Ah, Rhearent, here you are with reinforcements. But what is this? Are those elves? You'll have to explain this later!"
        [/message]
        [message]
            type=Squire
            # TODO: maybe switch from "or" to "and", or just choose one, once it's clear which is meant:
            [or]
                id=rider
            [/or]
            [or]
                name=_"Rhearent"
            [/or]
            message= _ "Don't worry! They are friends."
        [/message]
        [message]
            speaker=Fiannon
            message= _ "Be reassured, for we will save you."
        [/message]
        [message]
            speaker=Maeblie
            message= _ "You! Elves! You are forest friends, are you? Help us punish them!"
        [/message]
        [message]
            speaker=Fiannon
            message= _ "Fair Lady, excuse us, but we cannot punish these poor Peasants for what they needed to do. Everybody needs some wood to feed his fire. Especially in the winter. Even us Elves."
        [/message]
        [message]
            speaker=Maeblie
            message= _ "Then you deserve to die too! You all will die!"
        [/message]
        [message]
            speaker=Naia
            #po: sarcastically:
            message= _ "I really admire your diplomacy skills."
        [/message]
        [message]
            speaker=Silam
            message= _ "This isn't funny, Naia. We're in a serious situation. Fiannon, these are Fallen Faeries. They were once good Faeries, but something has corrupted them. They are extremely dangerous, especially in forest. We need to get everybody out of this forest as soon as possible."
        [/message]
        [message]
            speaker=Fiannon
            message= _ "But why? I always thought we elves were the best at fighting in the forest?"
        [/message]
        [message]
            speaker=Silam
            message= _ "And you're completely right. We Elves might be the best at fighting in the forest, but the Faeries <b>are</b> the forest. We can't win!"
        [/message]
        [message]
            speaker=Silam
            message= _ "Anyway, we need to get these peasants to safety in Aldril, and they won't be able to move much in the forest."
        [/message]

        {CLEAR_FOG 1 11 15 9}
        {HIGHLIGHT_IMAGE 15 16 items/gohere.png ""}

        [message]
            speaker=Silam
            message= _ "Also, pay attention, Fiannon. These enemies can teleport from one Great Tree to another; they are not bound to any location in this forest."
        [/message]

#ifdef EASY
        [message]
            speaker=Fiannon
            #po: extra strategy tip on EASY difficulty:
            message= _ "Hm, the Great Trees, you say? As in, the really big ones? I shall attempt to secure those!"
        [/message] #

        [message]
            speaker=Silam
            #po: extra strategy tip (continued) on EASY difficulty:
            message= _ "Yes, although be careful that you don't get stretched too thin trying to secure ALL of them; make sure you reserve enough troops for safely escorting the woodchoppers!"
        [/message] #
#endif

        [objectives]
            side=1
            [objective]
                description= _ "Move at least one of the tree fellers to Aldril at (15/16)"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Fiannon"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Naia"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Silam"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of all woodchoppers"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
        [set_variable]
            name=dead_peasants_warning_said
            value=no
        [/set_variable]
        [set_variable]
            name=peasants_seen
            value=yes
        [/set_variable]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x=48
            y=33
        [/filter]
        [message]
            speaker=narrator
            image=portraits/signpost_grey_woods_aldril_midlands.png~RIGHT()
            # wmllint: display on
            message= _ "Direction NE: Aldril
Direction NW: woodchoppers lodge
Direction SW: Midlands" # wmllint: no spellcheck
            # wmllint: display off
        [/message]
    [/event]

    {DEATHS}

    [event]
        name=last breath
        [filter]
            id=woodchopper3
        [/filter]
        [if]
            [have_unit]
                id=woodchopper1
                [or]
                    id=woodchopper2
                [/or]
                [or]
                    id=rider
                [/or]
            [/have_unit]
            [then]
                [message]
                    speaker=woodchopper3
                    message= _ "And I just wanted to gain some fair money! I should have stuck to my affairs as a ruffian."
                [/message]
                [if]
                    [variable]
                        name=dead_peasants_warning_said
                        equals=yes
                    [/variable]
                    [then]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die!"
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die! They'll believe we killed their woodchoppers, if none of them are there to attest the contrary. They won't let us pass, and we need to get to Elensefar."
                        [/message]
                        [set_variable]
                            name=dead_peasants_warning_said
                            value=yes
                        [/set_variable]
                    [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=woodchopper3
                    message= _ "And I just wanted to gain some fair money! I should have stuck to my affairs as a ruffian."
                [/message]
                [message]
                    speaker=Silam
                    message= _ "No! Fiannon, you've let them all die, you fool! They'll hunt us, because they will think we killed their tree fellers!"
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=woodchopper2
        [/filter]
        [if]
            [have_unit]
                id=woodchopper1
                [or]
                    id=woodchopper3
                [/or]
                [or]
                    id=rider
                [/or]
            [/have_unit]
            [then]
                [message]
                    speaker=woodchopper2
                    message= _ "No! I'll never see my family again! I should have stuck to my affairs as a peasant."
                [/message]
                [if]
                    [variable]
                        name=dead_peasants_warning_said
                        equals=yes
                    [/variable]
                    [then]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die!"
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die! They'll believe we killed their woodchoppers, if none of them are there to attest the contrary. They won't let us pass, and we need to get to Elensefar."
                        [/message]
                        [set_variable]
                            name=dead_peasants_warning_said
                            value=yes
                        [/set_variable]
                    [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=woodchopper2
                    message= _ "No! I'll never see my family again! I should have stuck to my affairs as a peasant."
                [/message]
                [message]
                    speaker=Silam
                    message= _ "No! Fiannon, you've let them all die, you fool! They'll hunt us, because they will think we killed their tree fellers!"
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=woodchopper1
        [/filter]
        [if]
            [have_unit]
                id=woodchopper2
                [or]
                    id=woodchopper3
                [/or]
                [or]
                    id=rider
                [/or]
            [/have_unit]
            [then]
                [message]
                    speaker=woodchopper1
                    message= _ "Argh! Now I will never become the best Bowman in the world! I should have stuck to my affairs as a woodsman."
                [/message]
                [if]
                    [variable]
                        name=dead_peasants_warning_said
                        equals=yes
                    [/variable]
                    [then]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die!"
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die! They'll believe we killed their woodchoppers, if none of them are there to attest the contrary. They won't let us pass, and we need to get to Elensefar."
                        [/message]
                        [set_variable]
                            name=dead_peasants_warning_said
                            value=yes
                        [/set_variable]
                    [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=woodchopper1
                    message= _ "Argh! Now I will never become the best Bowman in the world! I should have stuck to my affairs as a woodsman."
                [/message]
                [message]
                    speaker=Silam
                    message= _ "No! Fiannon, you've let them all die, you fool! They'll hunt us, because they will think we killed their tree fellers!"
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=rider
        [/filter]
        [if]
            [have_unit]
                id=woodchopper2
                [or]
                    id=woodchopper3
                [/or]
                [or]
                    id=woodchopper1
                [/or]
            [/have_unit]
            [then]
                [message]
                    speaker=rider
                    message= _ "I can't believe that I died! I just wanted to become a noble knight with shining armor one day..."
                [/message]
                [if]
                    [variable]
                        name=dead_peasants_warning_said
                        equals=yes
                    [/variable]
                    [then]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die!"
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Silam
                            message= _ "Don't let them all die! They'll believe we killed their woodchoppers, if none of them are there to attest the contrary. They won't let us pass, and we need to get to Elensefar."
                        [/message]
                        [set_variable]
                            name=dead_peasants_warning_said
                            value=yes
                        [/set_variable]
                    [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=rider
                    message= _ "I can't believe that I died! I just wanted to become a noble knight with shining armor one day..."
                [/message]
                [message]
                    speaker=Silam
                    message= _ "No! Fiannon, you've let them all die, you fool! They'll hunt us, because they will think we killed their tree fellers!"
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=15,16
            id=woodchopper1
        [/filter]
        [fire_event]
            name=woodchopper_arrived
        [/fire_event]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=15,16
            id=woodchopper2
        [/filter]
        [fire_event]
            name=woodchopper_arrived
        [/fire_event]
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=15,16
            id=woodchopper3
        [/filter]
        [fire_event]
            name=woodchopper_arrived
        [/fire_event]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=15,16
            id=rider
        [/filter]
        [if]
            [variable]
                name=peasants_seen
                equals=yes
            [/variable]
            [then]
                [fire_event]
                    name=woodchopper_arrived
                [/fire_event]
            [/then]
            [else]
                [message]
                    speaker=rider
                    message= _ "Wait! We have to rescue the other woodchoppers first!"
                [/message]
                [allow_undo][/allow_undo]
            [/else]
        [/if]
    [/event]

    [event]
        name=woodchopper_arrived
        [remove_item]
            [filter]
                x,y=15,16
            [/filter]
        [/remove_item]
        [store_unit]
            [filter]
                x,y=15,16
            [/filter]
            variable=talking_peasant
        [/store_unit]
        [move_unit]
            id=Fiannon
            to_x=17
            to_y=16
        [/move_unit]
        [move_unit]
            id=Naia
            to_x=16
            to_y=16
        [/move_unit]
        [move_unit]
            id=Silam
            to_x=17
            to_y=15
        [/move_unit]
        [move_unit]
            id=Alasar
            to_x=16
            to_y=15
        [/move_unit]
        [move_unit]
            id=Limwen
            to_x=18
            to_y=15
        [/move_unit]
        [move_unit]
            # wmllint: recognize Caravan
            id=Caravan
            to_x=18
            to_y=14
        [/move_unit]
        [message]
            speaker=$talking_peasant.id
            message= _ "You'd better not come with us to the castle. Sergeant Raief is not known to like you Elves. He thinks it's you who are always attacking us from the forest."
        [/message]
        [message]
            speaker=$talking_peasant.id
            message= _ "Yeah, stay there. That's a good place."
        [/message]
        {MODIFY_UNIT id=woodchopper1 side 4}
        {MODIFY_UNIT id=woodchopper2 side 4}
        {MODIFY_UNIT id=woodchopper3 side 4}
        {MODIFY_UNIT id=rider side 4}
        [move_unit]
            id=woodchopper1
            to_x=14,14,13,13
            to_y=15,14,14,13
        [/move_unit]
        [move_unit]
            id=woodchopper2
            to_x=14,14,15,15
            to_y=15,14,14,13
        [/move_unit]
        [move_unit]
            id=woodchopper3
            to_x=14,14,13
            to_y=15,14,14
        [/move_unit]
        [move_unit]
            id=rider
            to_x=14,14,15
            to_y=15,14,14
        [/move_unit]
        [message]
            speaker=Raief
            message= _ "Hail $talking_peasant.name|! Why are you returning so early? You shouldn't be finished with woodchopping until tomorrow evening. You know that our firewood is running low."
        [/message]
        [message]
            speaker=Raief
            message= _ "Where is Ronur? Wasn't he supposed to be with you? And why are you bringing these pointy ears with you? Has something happened?"
        [/message]
        [message]
            speaker=$talking_peasant.id
            message= _ "Milord, we were attacked during the night by some beings coming out of the trees, and they killed Ronur!"
        [/message]
        [message]
            speaker=Raief
            message= _ "Damn treehugger! I knew we should have never allied with those treehuggers! Until now, we've had no proof, that they have been the ones who have always been harassing us from the forest.... burning our crops, killing our cattle, and destroying our bridges! Sure, as long as nobody saw them, I couldn't do anything, the king wouldn't have listened. But now they have failed to kill all witnesses! And they are here in my reach! I won't let them escape, and the king will reward me greatly for clearing the plague that has been bothering Aldril for a few months now! Guards! Catch those beardless monsters!"
        [/message]
        [message]
            speaker=Raief
            message= _ "You! Green Devils! You will be executed for harassing an entire town for thousands of years!"
        [/message]
        [message]
            speaker=Fiannon
            message= _ "What?"
        [/message]
        [message]
            speaker=Alasar
            message= _ "He sure has a vast vocabulary of insults for us!"
        [/message]
        [store_unit]
            [filter]
                side=4
                [not]
                    id=Raief
                [/not]
                [not]
                    id=rider
                [/not]
                [not]
                    id=woodchopper1
                [/not]
                [not]
                    id=woodchopper2
                [/not]
                [not]
                    id=woodchopper3
                [/not]

                #that's one spearmen who else would walk on the spot where another one was
                #standing before, so that that one couldn't go back and stayed where he was
                #and that was pissing me off
                [not]
                    x,y=3,16
                [/not]
            [/filter]
            variable=moving_guards
            kill=no
        [/store_unit]
        {FOREACH moving_guards i}
            [move_unit]
                id=$moving_guards[$i].id
                to_x=17
                to_y=16
            [/move_unit]
        {NEXT i}

        #in german we say: "someone wants an extra sausage"
        [move_unit]
            x,y=3,16
            to_x=19
            to_y=15
        [/move_unit]

        [message]
            speaker=Alasar
            message= _ "(<i>calmly</i>) Touch me once, and I'll show pity. Touch me twice, and you die."
        [/message]
        [message]
            speaker=$talking_peasant.id
            message= _ "Hey, no, 'tis not what I wanted! It's not them who harassed us!"
        [/message]
        [message]
            speaker=Raief
            message= _ "And now they are bewitching you with their damned forest magic!"
        [/message]
        [message]
            speaker=Silam
            message= _ "Hey, Human, listen! I am a Commander too. I know what it means to lose your own men. Especially to an unknown enemy. But for Eloh's sake! We're not the ones you are looking for."
        [/message]
        [message]
            speaker=Raief
            message= _ "<b>Shut up, you unworthy elf!</b> I'll not listen to your filthy words!"
        [/message]
        [message]
            speaker=Naia
            message= _ "If you won't listen to him, then maybe you'll listen to me!"
        [/message]
        [store_unit]
            [filter]
                id=Naia
            [/filter]
            variable=Naia
        [/store_unit]
        [message]
            speaker=Naia
            message= _ "<b>I am a $Naia.type|.</b> I tell you, that these noble Elves have done nothing wrong! They were merely saving the Woodchoppers that <b>you</b> were unable to protect. I saw it with my own eyes! You should be thankful to them."
        [/message]
        [message]
            speaker=Raief
            message= _ "But... But... Argh! I don't know why you are travelling with pointy ears, but it must be a ruse! Either they have bewitched you too, or they have even bewitched my eyes..."
        [/message]
        {FLASH_WHITE ()}
        [teleport]
            [filter]
                id=Naia
            [/filter]
            animate=yes
            x,y=14,12
        [/teleport]
        [message]
            speaker=Naia
            message= _ "<b>I am a real $Naia.type!</b> And you know, that they would never be able to bewitch a real $Naia.type|."
        [/message]
        {FLASH_WHITE ()}
        [teleport]
            [filter]
                id=Naia
            [/filter]
            animate=yes
            x,y=16,16
        [/teleport]
        [message]
            speaker=Fiannon
            message= _ "(<i>whispering</i>) Wow, that was smooth. She sure knows how to impose respect."
        [/message]
        [message]
            speaker=$talking_peasant.id
            message= _ "Listen, Sergeant! They rescued us at the last moment. We were attacked by some kind of dark Faeries, but surely not by Elves."
        [/message]
        [message]
            speaker=Raief
            message= _ "(<i>having calmed down</i>) Seems like I will have you let you go. Even if I still don't really believe you, my word is nothing against this $Naia.type|."
        [/message]
        # Be sure to keep this after the last usage of the Naia variable:
        {CLEAR_VARIABLE Naia}
        [message]
            speaker=Raief
            message= _ "Guards, release them!"
        [/message]
        {FOREACH moving_guards i}
            [move_unit]
                id=$moving_guards[$i].id
                to_x=$moving_guards[$i].x
                to_y=$moving_guards[$i].y
            [/move_unit]
        {NEXT i}
        {CLEAR_VARIABLE moving_guards}

        #Mr. sausage again
        [move_unit]
            x,y=19,15
            to_x=3
            to_y=16
        [/move_unit]

        [if]
            [have_unit]
                id=Caravan
            [/have_unit]
            [then]
                [message]
                    speaker=Raief
                    message= _ "(<i>Sigh</i>) And who are you bringing with you in this Caravan?"
                [/message]
                [message]
                    speaker=Fiannon
                    message= _ "Show the Commander our prey!"
                [/message]
                [kill]
                    id=Caravan
                    fire_event=no
                    animate=no
                [/kill]
                {PLACE_IMAGE (scenery/caravan.png) 18 14}
                [unstore_unit]
                    x,y=18,14
                    variable=caravan_unit
                [/unstore_unit]
                [move_unit]
                    id=$caravan_unit.id
                    to_x=17
                    to_y=14
                [/move_unit]
                [unstore_unit]
                    x,y=18,14
                    variable=captured_Duron_Bleil
                [/unstore_unit]
                [message]
                    speaker=Fiannon
                    message= _ "Commander Raief, may I present you the mighty Duron Bleil."
                [/message]
                [message]
                    speaker=Raief
                    message= _ "What? But... But... I didn't even know that he was in this part of the Kingdom!"
                [/message]
                [message]
                    # wmllint: recognize Bandits_leader
                    speaker=Bandits_leader
                    message= _ "(<i>spits</i>) Yeah, without these Elves you would never have gotten me!"
                [/message]
                [message]
                    speaker=Raief
                    message= _ "Seems like I have to thank you. Here, take the reward which was set on his head."
                [/message]
                [gold]
                    amount=100
                    side=1
                [/gold]
                [message]
                    speaker=narrator
                    image=portraits/bag-gold.png
                    message= _ "You get 100 gold coins!"
                [/message]
                [sound]
                    name=gold.ogg
                [/sound]
                [set_variable]
                    name=duron_captured
                    value=yes
                [/set_variable]
            [/then]
        [/if]
        [delay]
            time=1000
        [/delay]
        [message]
            speaker=Raief
            message= _ "Come on, go away. What are you waiting for?"
        [/message]
        [message]
            speaker=Fiannon
            message= _ "I've got an idea!"
        [/message]
        [message]
            speaker=Fiannon
            message= _ "To prove to you that we're not the ones you're looking for, we'll help you clear this danger. With our help you'll be able to get rid of the menace coming from this forest once and for all."
        [/message]
        [message]
            speaker=Silam
            message= _ "Fiannon! What are you saying? We need to get to Wesmere as soon as possible. Now that no one is in actual danger here, we must not delay."
        [/message]
        [message]
            speaker=Limwen
            message= _ "I think it's a good idea. We need to help these poor people."
        [/message]
        [message]
            speaker=Alasar
            message= _ "Fighting these faeries in the forest will be a good opportunity to train my accuracy!"
        [/message]
        [message]
            speaker=Naia
            message= _ "Think of it, Sergeant. Use this chance to protect your citizens!"
        [/message]
        [message]
            speaker=Raief
            message= _ "If you think so, wise mage... Woodchoppers, go home now. It's time for real warriors."
        [/message]
        [message]
            speaker=$talking_peasant.id
            message= _ "Wait! From now on we'd like to fight with the Elves!"
        [/message]
        [message]
            speaker=rider
            message= _ "Lady Naia has been so kind to us!"
        [/message]
        [message]
            speaker=Raief
            message= _ "Hrmpf, my own people are deserting me? Well, seems like it's not my day anyway... Everybody do whatever he wants!"
        [/message]
        {MODIFY_UNIT id=woodchopper1 side 1}
        {MODIFY_UNIT id=woodchopper2 side 1}
        {MODIFY_UNIT id=woodchopper3 side 1}
        {MODIFY_UNIT id=rider side 1}
        {UNMAKE_HERO woodchopper1}
        {UNMAKE_HERO woodchopper2}
        {UNMAKE_HERO woodchopper3}
        {UNMAKE_HERO rider}
        {MODIFY_UNIT id=woodchopper1 overlays "misc/loyal-icon.png"}
        {MODIFY_UNIT id=woodchopper2 overlays "misc/loyal-icon.png"}
        {MODIFY_UNIT id=woodchopper3 overlays "misc/loyal-icon.png"}
        {MODIFY_UNIT id=rider overlays "misc/loyal-icon.png"}
        [store_unit]
            [filter]
                id=Raief
            [/filter]
            variable=Raief
            kill=no
        [/store_unit]
        [if]
            [have_unit]
                id=Maeblie
            [/have_unit]
            [then]
                [message]
                    speaker=Maeblie
                    # wmllint: local spelling grrrrrr
                    message= _ "You'll see us again later, grrrrrr..."
                [/message]
                [store_unit]
                    [filter]
                        id=Maeblie
                    [/filter]
                    kill=no
                    variable=Maeblie
                [/store_unit]
                [store_locations]
                    x,y=$Maeblie.x,$Maeblie.y
                    variable=Maeblie_terrain
                [/store_locations]
                [if]
                    [variable]
                        name=Maeblie_terrain.terrain
                        equals=Gg^Fet
                    [/variable]
                    [or]
                        [variable]
                            name=Maeblie_terrain.terrain
                            equals=Gg^Fetd
                        [/variable]
                    [/or]
                    [then]
                        # do nothing
                    [/then]
                    [else]
                        [set_variable]
                            name=search_radius
                            value=1
                        [/set_variable]
                        [store_locations]
                            terrain=*^Fet*
                            [and]
                                [filter]
                                    id=Maeblie
                                [/filter]
                                radius=$search_radius
                            [/and]
                            [not]
                                [filter]
                                [/filter]
                            [/not]
                            variable=great_trees_to_teleport
                        [/store_locations]
                        [while]
                            [variable]
                                name=great_trees_to_teleport.length
                                less_than=1
                            [/variable]
                            [do]
                                [set_variable]
                                    name=search_radius
                                    add=1
                                [/set_variable]
                                [store_locations]
                                    terrain=*^Fet*
                                    [and]
                                        [filter]
                                            id=Maeblie
                                        [/filter]
                                        radius=$search_radius
                                    [/and]
                                    [not]
                                        [filter]
                                        [/filter]
                                    [/not]
                                    variable=great_trees_to_teleport
                                [/store_locations]
                            [/do]
                        [/while]
                        [move_unit]
                            id=Maeblie
                            to_x=$great_trees_to_teleport.x
                            to_y=$great_trees_to_teleport.y
                        [/move_unit]
                    [/else]
                [/if]
                [animate_unit]
                    flag=pre_teleport
                    [filter]
                        id=Maeblie
                    [/filter]
                [/animate_unit]
                [store_unit]
                    [filter]
                        id=Maeblie
                    [/filter]
                    variable=Maeblie
                    kill=yes
                [/store_unit]
                {CLEAR_VARIABLE great_trees_to_teleport}
                {CLEAR_VARIABLE peasants_seen}
                {CLEAR_VARIABLE search_radius}
            [/then]
        [/if]
        {CLEAR_VARIABLE dead_peasants_warning_said}
        {CLEAR_VARIABLE peasants_seen}
        {CLEAR_VARIABLE Maeblie_terrain}
        {CLEAR_VARIABLE captured_Duron_Bleil}
        {CLEAR_VARIABLE killing_unit}
        {CLEAR_VARIABLE caravan_unit}
        {CLEAR_VARIABLE talking_peasant}
        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=last_breath
        [filter]
            id=Maeblie
        [/filter]
        [message]
            speaker=Maeblie
            message= _ "Ha, you thought you could get me? Well, you thought wrong!"
        [/message]
        ### check ob Maeblie sich gerade auf einem groen Baum befindet, oder nicht.
        ### Weil wenn ja, dann sollte sie gleich von dort teleportieren und nicht bis zum nachsten Baum rennen.
        ### English (Google Translate, with postediting):
        ### check whether Maeblie is currently on a Great Tree or not.
        ### Because if so, then she should teleport from there and not run to the next tree.
        [store_unit]
            [filter]
                id=Maeblie
            [/filter]
            variable=Maeblie
            kill=no
        [/store_unit]
        [store_locations]
            x,y=$Maeblie.x,$Maeblie.y
            variable=Maeblie_terrain
        [/store_locations]
#ifdef DEBUG_MODE
#ifdef DEBUG_MSG
        {DEBUG_MSG "Debug message: stored Maeblie_terrain is $Maeblie_terrain.terrain"}
#endif
#endif
        [if]
            [variable]
                name=Maeblie_terrain.terrain
                equals=*^Fet*
            [/variable]
            [then]
#ifdef DEBUG_MODE
#ifdef DEBUG_MSG
                #po: message only for developers; ok to skip translating:
                {DEBUG_MSG _"Debug message: Maeblie is already on a Great Tree; skipping additional animation"}
#endif
#endif
            [/then]
            [else]
                [set_variable]
                    name=search_radius
                    value=1
                [/set_variable]
                [store_locations]
                    terrain=*^Fet*
                    [and]
                        [filter]
                            x,y=$x1,$y1
                        [/filter]
                        radius=$search_radius
                    [/and]
                    [not]
                        [filter]
                        [/filter]
                    [/not]
                    variable=great_trees_to_teleport
                [/store_locations]
                [while]
                    [variable]
                        name=great_trees_to_teleport.length
                        less_than=1
                    [/variable]
                    [do]
                        [set_variable]
                            name=search_radius
                            add=1
                        [/set_variable]
                        [store_locations]
                            terrain=*^Fet*
                            [and]
                                [filter]
                                    x,y=$x1,$y1
                                [/filter]
                                radius=$search_radius
                            [/and]
                            [not]
                                [filter]
                                [/filter]
                            [/not]
                            variable=great_trees_to_teleport
                        [/store_locations]
                    [/do]
                [/while]
                [move_unit]
                    id=Maeblie
                    to_x=$great_trees_to_teleport.x
                    to_y=$great_trees_to_teleport.y
                [/move_unit]
            [/else]
        [/if]
        [animate_unit]
            flag=pre_teleport
            [filter]
                id=Maeblie
            [/filter]
        [/animate_unit]
        [store_unit]
            [filter]
                id=Maeblie
            [/filter]
            variable=Maeblie
            kill=yes
        [/store_unit]
        {CLEAR_VARIABLE great_trees_to_teleport}
#ifdef __UNUSED__
        {CLEAR_VARIABLE Maeblie_terrain}
#endif
    [/event]

    [event]
        name=side 2 turn end
        first_time_only=no
        [filter_condition]
            [variable]
                name=peasants_seen
                equals=yes
            [/variable]
        [/filter_condition]
        [store_locations]
            terrain=*^Fet*
            variable=spawnpoints_faeries
            [not]
                [filter]
                [/filter]
            [/not]
        [/store_locations]
        {FOREACH spawnpoints_faeries i}
#ifdef EASY
            {VARIABLE_OP hit rand (1,1,0,0,0,0,0,0,0,0,0)}
#endif
#ifdef NORMAL
            {VARIABLE_OP hit rand (1,1,1,0,0,0,0,0,0,0,0)}
#endif
#ifdef HARD
            {VARIABLE_OP hit rand (1,1,1,1,0,0,0,0,0,0,0)}
#endif

            [if]
                {VARIABLE_CONDITIONAL hit equals 1}
                [then]
                    {GENERIC_UNIT 2 (Fallen Sprite) ($spawnpoints_faeries[$i].x) ($spawnpoints_faeries[$i].y)} {SLOWED_IF_EASY}
                    [+unit]
                        animate=yes
                    [/unit]
                [/then]
            [/if]
        {NEXT i}
        {CLEAR_VARIABLE spawnpoints_faeries}
        {CLEAR_VARIABLE hit}
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            id=woodchopper1,woodchopper2,woodchopper3,rider
            [filter_location]
                x,y=30,25
                radius=12
            [/filter_location]
        [/filter]

        [role]
            id=$unit.id
            role=warner
        [/role]
        [message]
            role=warner
            message= _ "Remember guys, it is said that there are bandits roaming the area. Pay attention!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            [filter_location]
                x,y=30,25
                radius=7
            [/filter_location]
        [/filter]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "As you near some hills, you suddenly discover some old ruins, which you couldn't see before because of the fog."
        [/message]
        [terrain]
            x,y=30,23
            terrain=Ce
        [/terrain]
        [terrain]
            x,y=30,24
            terrain=Khr
        [/terrain]
        [terrain]
            x,y=30,25
            terrain=Ce
        [/terrain]
        [terrain]
            x,y=29,25
            terrain=Chr
        [/terrain]
        {PLACE_IMAGE (scenery/caravan.png) 29 24}
        [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x,y=30,24
            radius=7
        [/lift_fog]
        [unit]
            id=Bandits_leader
            canrecruit=yes
            type=Shadow Lord
            x,y=30,24
            side=3
            placement=map
            passable=yes
            name=_"Duron Bleil"
            random_traits=no
        [/unit]
        [micro_ai]
            side=3
            ai_type=goto
            action=add

            [filter]
                id=Bandits_leader
            [/filter]
            [filter_location]
                [filter]
                    id=Bandits_leader
                [/filter]
            [/filter_location]
        [/micro_ai]
        {NAMED_NOTRAIT_UNIT 3 Bandit 31 23 (Bandits_assistant) (_"Orym") } {SLOWED_IF_EASY}
        {GENERIC_UNIT 3 Thug 31 27} {SLOWED_IF_EASY}
        {GENERIC_UNIT 3 Footpad 26 28} {SLOWED_IF_EASY}
        {GENERIC_UNIT 3 Poacher 36 20} {SLOWED_IF_EASY}
        [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            multiturn=yes
            x,y=30,24
            radius=8
        [/lift_fog]
        [message]
            speaker=Bandits_leader
            image=portraits/Shadow-Mage.png
            message= _ "Let's see, who do we have here? Some fine elvish gentlemen."
        [/message]
        [message]
            speaker=Bandits_assistant
            message= _ "They're said to always have much gold! Let's get them!"
        [/message]
        [message]
            speaker=Naia
            message= _ "Hey, those are members of the Shadow mages guild! They've escaped our inspectors for hundreds of years!"
        [/message]
        [message]
            speaker=Naia
            message= _ "And this is their leader, Duron Bleil. There's a huge bounty waiting for the one who gets him."
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Move at least one of the tree fellers to Aldril at (15/16)"
                condition=win
            [/objective]
            [objective]
                description= _ "Defeat Duron Bleil"+{OBJECTIVE_FOOTNOTE _"(special bonus)"}
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Fiannon"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Naia"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Silam"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of all peasants"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Bandits_leader
        [/filter]
        [message]
            speaker=Bandits_leader
            image=portraits/Shadow-Mage.png
            message= _ "Alright, alright, I give up. Please show mercy!"
        [/message]
        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            variable=captured_Duron_Bleil
            kill=yes
        [/store_unit]
        [set_variable]
            name=captured_Duron_Bleil.hitpoints
            value=$captured_Duron_Bleil.max_hitpoints
        [/set_variable]
        [set_variable]
            name=captured_Duron_Bleil.status.slowed
            value=no
        [/set_variable]
        [if]
            [variable]
                name=second_unit.id
                equals=Fiannon
            [/variable]
            [or]
                [variable]
                    name=second_unit.id
                    equals=Naia
                [/variable]
            [/or]
            [or]
                [variable]
                    name=second_unit.id
                    equals=Silam
                [/variable]
            [/or]
            [or]
                [variable]
                    name=second_unit.id
                    equals=woodchopper1
                [/variable]
            [/or]
            [or]
                [variable]
                    name=second_unit.id
                    equals=woodchopper2
                [/variable]
            [/or]
            [or]
                [variable]
                    name=second_unit.id
                    equals=woodchopper3
                [/variable]
            [/or]
            [or]
                [variable]
                    name=second_unit.id
                    equals=rider
                [/variable]
            [/or]
            [then]
                [role]
                    role=guy
                    race=elf
                    side=1
                    [not]
                        id=Naia
                    [/not]
                    [not]
                        id=Fiannon
                    [/not]
                    [not]
                        id=Silam
                    [/not]
                    [not]
                        id=woodchopper1
                    [/not]
                    [not]
                        id=woodchopper2
                    [/not]
                    [not]
                        id=woodchopper3
                    [/not]
                    [not]
                        id=rider
                    [/not]
                [/role]
                [store_unit]
                    [filter]
                        role=guy
                    [/filter]
                    variable=killing_unit
                [/store_unit]
                [message]
                    speaker=Fiannon
                    message= _ "$killing_unit.name, enchain Duron Bleil and bring him to Aldril. Look, there's even a cart you can use for this."
                [/message]
                [message]
                    speaker=$killing_unit.id
                    image=portraits/enchained.png
                    message= _ "Of course!"
                [/message]
                [remove_item]
                    x,y=29,24
                [/remove_item]
                {HIGHLIGHT_IMAGE 29 24 (scenery/caravan.png) ""}
                [move_unit]
                    id=$killing_unit.id
                    to_x=29
                    to_y=24
                [/move_unit]
                [message]
                    speaker=$killing_unit.id
                    message= _ "Hey, look what they had in their caravan! 200 Gold! They must have stolen from many travellers."
                [/message]
                [gold]
                    amount=200
                    side=1
                [/gold]
                [message]
                    speaker=narrator
                    image=portraits/bag-gold.png
                    message= _ "You get 200 gold coins!"
                [/message]
                [sound]
                    name=gold.ogg
                [/sound]
                [store_unit]
                    [filter]
                        id=$killing_unit.id
                    [/filter]
                    variable=caravan_unit
                    kill=yes
                [/store_unit]
                [message]
                    speaker=narrator
                    image=units/mechanical/caravan.png
                    message= _ "$killing_unit.name is now driving the caravan, and will rejoin your party upon delivery of the prisoner."
                [/message]
                [set_variable]
                    name=caravan_unit.hitpoints
                    value=$caravan_unit.max_hitpoints
                [/set_variable]
                [unit]
                    name= _ "Prisoners transport"
                    id=Caravan
                    type=Caravan
                    side=1 # (default when left unspecified)
                    x,y=29,24
                    random_traits=no
                [/unit]
                [remove_item]
                    [filter]
                        x,y=29,24
                    [/filter]
                [/remove_item]
                [objectives]
                    side=1
                    [objective]
                        # wmllint: local spelling treefellers
                        description= _ "Move at least one of the treefellers to Aldril at (15/16)"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Protect the caravan with Duron Bleil until you can serve him to justice"+{OBJECTIVE_FOOTNOTE _"(special bonus)"}
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Death of Fiannon"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Naia"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Silam"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of all peasants"
                        condition=lose
                    [/objective]
                    {TURNS_RUN_OUT}
                    [gold_carryover]
                        bonus=yes
                        carryover_percentage=40
                    [/gold_carryover]
                [/objectives]
            [/then]
            [else]
                [set_variable]
                    name=killing_unit_name
                    value=$second_unit.name
                [/set_variable]
                [set_variable]
                    name=killing_unit_id
                    value=$second_unit.id
                [/set_variable]
                [message]
                    speaker=$killing_unit_id
                    message= _ "Should I kill him?"
                [/message]
                [message]
                    speaker=Fiannon
                    message= _ "No, we'll leave it to the Commander of Aldril's to decide what to do with him."
                [/message]
                [message]
                    speaker=Fiannon
                    message= _ "$killing_unit_name, enchain Duron Bleil and bring him to Aldril. Look, there's even a cart you can use for this."
                [/message]
                [message]
                    speaker=$killing_unit_id
                    image=portraits/enchained.png
                    message= _ "Of course!"
                [/message]
                [remove_item]
                    x,y=29,24
                [/remove_item]
                {HIGHLIGHT_IMAGE 29 24 (scenery/caravan.png) ""}
                [move_unit]
                    id=$second_unit.id
                    to_x=29
                    to_y=24
                [/move_unit]
                [message]
                    speaker=$killing_unit_id
                    message= _ "Hey, look what they had in their caravan! 200 Gold! They must have stolen from many travellers."
                [/message]
                [gold]
                    amount=200
                    side=1
                [/gold]
                [message]
                    speaker=narrator
                    image=portraits/bag-gold.png
                    message= _ "You get 200 gold coins!"
                [/message]
                [sound]
                    name=gold.ogg
                [/sound]
                [store_unit]
                    [filter]
                        id=$killing_unit_id
                    [/filter]
                    variable=caravan_unit
                    kill=yes
                [/store_unit]
                [message]
                    speaker=narrator
                    image=units/mechanical/caravan.png
                    message= _ "$killing_unit_name is now driving the caravan, and will rejoin your party upon delivery of the prisoner."
                [/message]
                [set_variable]
                    name=caravan_unit.hitpoints
                    value=$caravan_unit.max_hitpoints
                [/set_variable]
                [unit]
                    id=Caravan
                    type=Caravan
                    side=1 # (default when left unspecified)
                    x,y=29,24
                    random_traits=no
                [/unit]
                [remove_item]
                    [filter]
                        x,y=29,24
                    [/filter]
                [/remove_item]
                [objectives]
                    side=1
                    [objective]
                        description= _ "Move at least one of the treefellers to Aldril at (15/16)"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Protect the caravan with Duron Bleil until you can serve him to justice"+{OBJECTIVE_FOOTNOTE _"(special bonus)"}
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Death of Fiannon"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Naia"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Silam"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of all peasants"
                        condition=lose
                    [/objective]
                    {TURNS_RUN_OUT}
                    [gold_carryover]
                        bonus=yes
                        carryover_percentage=40
                    [/gold_carryover]
                [/objectives]
            [/else]
        [/if]
    [/event]
    {GLOBAL_EVENTS}
[/scenario]
